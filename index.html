<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
        <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://theretrosimulatorstimulator.neocities.org/center.css">
<header>
<center><marquee direction="right" scrollamount="15"><p><a href="https://stats.uptimerobot.com/VWGMlt2GP6" target="_blank">NEW STATUS PAGE!</a> - Website and internal API by G1nX-01 | Icon and CelLua Monomod by monochromeninja | CelLua Machine by KyyYay | Original Cell Machine by Sam Hogan</p></marquee></center>
<hr>
<center><a href="https://discord.gg/jC3p7PxxU5"><img src="https://logodownload.org/wp-content/uploads/2017/11/discord-logo-1-1.png" height="100px" title="JOIN OUR DISCORD!"></img></a></center>
</header>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400&display=swap" rel="stylesheet">

    <style>
     @font-face {
   font-family: retro;
   src: url(nokiafc22.ttf);
}
@keyframes move-background {
  from {
    background-position: 100% 0; /* starting position */
  }
  to {
    background-position: 0 0; /* ending position */
  }
}
	  html {
        font-family: retro;
		  background: #202020;
		  background-size: 50px 50px;
		  background-image: url("bg.png");
            background-repeat: repeat;
			color: white;
          animation: move-background 60s linear infinite;
      }
	  a {
	  color: DarkSalmon;
	  }
      .button {
	box-shadow: 0px 10px 14px -7px #276873;
	background:linear-gradient(to bottom, #599bb3 5%, #408c99 100%);
	background-color:#599bb3;
	border-radius:8px;
	display:inline-block;
	cursor:pointer;
	color:#ffffff;
	font-family:Arial;
	font-size:20px;
	font-weight:bold;
	padding:13px 32px;
	text-decoration:none;
	text-shadow:0px 1px 0px #3d768a;
}
.button:hover {
	background:linear-gradient(to bottom, #408c99 5%, #599bb3 100%);
	background-color:#408c99;
}
.button:active {
	position:relative;
	top:1px;
}

header {
  padding: 3px;
  background-color: grey;
  color: white;
  up: 100%;
  bottom: 0;

  /* And if you want the div to be full-width: */
  left: 0;
  right: 0;
}

.btn {
  background: #4ad934;
  background-image: -webkit-linear-gradient(top, #4ad934, #3b9949);
  background-image: -moz-linear-gradient(top, #4ad934, #3b9949);
  background-image: -ms-linear-gradient(top, #4ad934, #3b9949);
  background-image: -o-linear-gradient(top, #4ad934, #3b9949);
  background-image: linear-gradient(to bottom, #4ad934, #3b9949);
  -webkit-border-radius: 28;
  -moz-border-radius: 28;
  border-radius: 28px;
  color: #ffffff;
  font-size: 23px;
  padding: 10px 20px 10px 20px;
  text-decoration: none;
}

.btn:hover {
  background: #55e63e;
  background-image: -webkit-linear-gradient(top, #55e63e, #4ebd5d);
  background-image: -moz-linear-gradient(top, #55e63e, #4ebd5d);
  background-image: -ms-linear-gradient(top, #55e63e, #4ebd5d);
  background-image: -o-linear-gradient(top, #55e63e, #4ebd5d);
  background-image: linear-gradient(to bottom, #55e63e, #4ebd5d);
  text-decoration: none;
}
    </style>
	
	<script src="https://cdn.jsdelivr.net/gh/nodeca/pako@master/dist/pako.js"></script>
	
    <script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js" integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V" crossorigin="anonymous"></script>

<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    
    <title>MLB - Monomod Level Browser</title>
  </head>
  <body>
      <center><h1>Monomod Level Browser - Post a level</h1></center>
    <center>Bored? Go see <a href="all" target="_blank">other people's levels</a>!</center>
    <br>
    <center>
      <div style="width: 200px">
        <details>
      <summary style="cursor: pointer;">Click the arrow to post your own level!</summary>
          <br>
      <form action="javascript:void(0)" onsubmit="init()">
          <label for="title">The title of your new masterpiece:</label><br>
          <input type="text" id="title" required maxlength="20"><br><br>
          <label for="code">Insert a playable Monomod code below:</label><br>
          <!--<small id="characterindicator">0</small>-->
          <center>
            <textarea name="Text1" id="code" cols="40" rows="5" maxlength="1000" required style="height: 143px; width: 186px;"></textarea>
          </center>
      <br><br>
            <input type="checkbox" id="isvanilla"> <small>Vanilla level (without any monomod features in it)</small>
           <br><br>
          <input type="checkbox" id="rules" required> <small>By checking this, you agree to the <a href="rules" target="_blank">rules</a>.</small>
            <br><br>
          <center><input type="submit" value="Submit" id="submit" class="btn" style="cursor: pointer;"></center>
       </form>
</center> 
    </div>
    </details>
  <script>
	function isValidZlib(b64) {
    let strData = atob(b64);
    let charData = strData.split("").map(x => x.charCodeAt(0));
    let binData = new Uint8Array(charData);
    try {
        let data = pako.inflate(binData);
        return true;
    } catch {
        return false;
    }
}

const BASE84 = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!$%&+-.=?^{}/#_*':,@~|";

function isValidB84(b84) {
    return [...b84].every(x => BASE84.includes(x));
}

function isValidK3(code) {
  let parts = code.split(";");
  return code.startsWith("K3") && ";:".includes(code[2]) && parts.length >= 5 &&
      isValidB84(parts[1]) && isValidB84(parts[2]) && isValidB84(parts[3]) &&
      parts[3].length === 1 && isValidZlib(parts[4]);
}
	
	function init() {
	console.log(isValidK3(document.getElementById("code").value))
	
	  if (isValidK3(document.getElementById("code").value) == false) {
	  Toastify({

text: "That code is invalid. Remember: Only K3 codes are supported for now!",

duration: 4000

}).showToast();
	return
	  } else {
	  dsagydgshaadshj()
	  }
	}
	
	function dsagydgshaadshj() {
	
	$.ajax({
  url: "https://b3vk4s-3000.csb.app/doesthatevenexist/" + document.getElementById("title").value,
  method: "GET",
  success: function(response) {
    console.log(response);
	if (response.result == false) {
	ajaskhddhjska()
	return
	} else {
	Toastify({

text: "Sorry, but that already exists...",

duration: 3000

}).showToast();
	return
	}
  },
  error: function(xhr, status, error) {
    console.log("Error: " + error);
  }
});
	
	}
	
	function validateVanilla(str) {
       if (str) { return "on" } else { return "off" }
	}
	function ajaskhddhjska() {
	 fetch('https://ipapi.co/json')
    .then(response => response.json())
    .then(data => {
	console.log(JSON.stringify({title: document.getElementById("title").value, code: document.getElementById("code").value, isvanilla: validateVanilla(document.getElementById("isvanilla").checked), country: data.country_code}))
	$.ajax({
  type: "POST",
  url: "https://b3vk4s-3000.csb.app/newcodething",
  data: JSON.stringify({title: document.getElementById("title").value, code: document.getElementById("code").value, isvanilla: validateVanilla(document.getElementById("isvanilla").checked), country: data.country_code}),
  contentType: "application/json",
  success: function(data) {
    Toastify({
destination: "/monomod-browser/all",
  
  newWindow: true,
  
text: 'Your level "' + document.getElementById("title").value + '" was submitted successfully! Click this popup to see it in the list!',

duration: 3000

}).showToast();
  },
  error: function(jqXHR, textStatus, errorThrown) {
    console.error(jqXHR, textStatus, errorThrown)
  }
});
	});


}

  </script>
  </body>
</html>